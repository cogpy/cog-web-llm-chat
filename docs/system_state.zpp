â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WebLLM Chat - System State Specification (Z++)                              â”‚
â”‚ Formal specification of system state and global invariants                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SECTION 1: CHAT SYSTEM STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ ChatStore â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Complete state of the chat system                                           â”‚
â”‚ Manages all chat sessions, messages, and conversation state                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ChatStore]
  sessions: seq ChatSession
  currentSessionIndex: â„•
  
  -- State Invariants
  sessions_nonempty: length(sessions) > 0
  
  current_session_valid: 
    0 â‰¤ currentSessionIndex < length(sessions)
  
  session_ids_unique: 
    âˆ€ i, j: â„• â€¢ i â‰  j âˆ§ i, j < length(sessions) âŸ¹ 
      sessions[i].id â‰  sessions[j].id
  
  session_timestamps_monotonic: 
    âˆ€ i, j: â„• â€¢ i < j < length(sessions) âŸ¹ 
      sessions[i].lastUpdate â‰¤ sessions[j].lastUpdate
  
  no_concurrent_generation: 
    âˆ€ i, j: â„• â€¢ i â‰  j âˆ§ i, j < length(sessions) âŸ¹ 
      Â¬(sessions[i].isGenerating âˆ§ sessions[j].isGenerating)
  
  active_session_generation: 
    sessions[currentSessionIndex].isGenerating âŸ¹ 
      âˆƒ m: ChatMessage â€¢ 
        m âˆˆ sessions[currentSessionIndex].messages âˆ§ 
        m.streaming = true

â”Œâ”€ ÎChatStore â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Read-only chat store (state unchanged)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ÎChatStore]
  ChatStore
  ChatStore'
  
  sessions' = sessions
  currentSessionIndex' = currentSessionIndex

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SECTION 2: CONFIGURATION STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ ConfigStore â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Application configuration state                                             â”‚
â”‚ Manages model settings, UI preferences, and global options                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ConfigStore]
  config: ConfigType
  
  -- State Invariants
  model_exists_in_registry: 
    config.modelConfig.model âˆˆ {m.name | m âˆˆ config.models}
  
  compatible_client_model: 
    config.modelClientType = WEBLLM âŸ¹ 
      âˆƒ m: ModelRecord â€¢ 
        m âˆˆ config.models âˆ§ 
        m.name = config.modelConfig.model âˆ§
        m.provider âˆˆ {WebLLM, MLC}
  
  mlc_endpoint_required: 
    config.modelClientType = MLCLLM_API âŸ¹ 
      length(config.modelConfig.mlc_endpoint) > 0 âˆ§
      is_valid_url(config.modelConfig.mlc_endpoint)
  
  cache_type_compatibility: 
    config.modelClientType = WEBLLM âŸ¹ 
      config.cacheType âˆˆ {Cache, IndexDB}

â”Œâ”€ ÎConfigStore â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Read-only config store (state unchanged)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ÎConfigStore]
  ConfigStore
  ConfigStore'
  
  config' = config

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SECTION 3: OPENCOG MULTI-AGENT STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ OrchestrationState â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ State of the multi-agent orchestration system                               â”‚
â”‚ Manages agents, tasks, messages, and coordination                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[OrchestrationState]
  agents: seq char â†’ Agent
  tasks: seq char â†’ Task
  messageQueue: seq AgentMessage
  activeSession: seq char
  
  -- State Invariants
  agent_ids_match_keys: 
    âˆ€ id: seq char â€¢ id âˆˆ dom agents âŸ¹ agents(id).id = id
  
  task_ids_match_keys: 
    âˆ€ id: seq char â€¢ id âˆˆ dom tasks âŸ¹ tasks(id).id = id
  
  task_assignment_valid: 
    âˆ€ t: Task â€¢ t âˆˆ ran tasks âˆ§ t.assignedTo â‰  "" âŸ¹ 
      t.assignedTo âˆˆ dom agents
  
  task_dependencies_exist: 
    âˆ€ t: Task â€¢ t âˆˆ ran tasks âŸ¹ 
      âˆ€ dep: seq char â€¢ dep âˆˆ t.dependencies âŸ¹ dep âˆˆ dom tasks
  
  task_dependency_acyclic: 
    âˆ€ t: Task â€¢ t âˆˆ ran tasks âŸ¹ 
      t.id âˆ‰ transitive_task_dependencies(t.id)
  
  message_sender_exists: 
    âˆ€ m: AgentMessage â€¢ m âˆˆ messageQueue âŸ¹ 
      m.senderId âˆˆ dom agents
  
  message_receiver_exists: 
    âˆ€ m: AgentMessage â€¢ m âˆˆ messageQueue âˆ§ m.type â‰  BROADCAST âŸ¹ 
      m.receiverId âˆˆ dom agents
  
  active_session_exists: 
    activeSession â‰  "" âŸ¹ 
      âˆƒ t: Task â€¢ t âˆˆ ran tasks âˆ§ t.id = activeSession
  
  agent_status_consistency: 
    âˆ€ a: Agent â€¢ a âˆˆ ran agents âŸ¹ 
      (a.status = BUSY âŸº âˆƒ t: Task â€¢ 
        t âˆˆ ran tasks âˆ§ t.assignedTo = a.id âˆ§ t.status = IN_PROGRESS)
  
  capability_based_assignment: 
    âˆ€ t: Task â€¢ t âˆˆ ran tasks âˆ§ t.assignedTo â‰  "" âŸ¹ 
      âˆƒ cap: seq char â€¢ 
        cap âˆˆ agents(t.assignedTo).capabilities âˆ§
        requires_capability(t.description, cap)

â”Œâ”€ ÎOrchestrationState â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Read-only orchestration state (state unchanged)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ÎOrchestrationState]
  OrchestrationState
  OrchestrationState'
  
  agents' = agents
  tasks' = tasks
  messageQueue' = messageQueue
  activeSession' = activeSession

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SECTION 4: KNOWLEDGE REPRESENTATION STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ AtomSpace â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Knowledge graph state (OpenCog AtomSpace)                                   â”‚
â”‚ Stores atoms with truth values and attention values                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[AtomSpace]
  atoms: seq AtomNode
  atomIndex: seq char â†’ â„•  -- Name to position index
  
  -- State Invariants
  atom_structure_valid: 
    âˆ€ a: AtomNode â€¢ a âˆˆ atoms âŸ¹ is_well_formed_atom(a)
  
  atom_children_exist: 
    âˆ€ a: AtomNode â€¢ a âˆˆ atoms âˆ§ length(a.children) > 0 âŸ¹ 
      âˆ€ c: AtomNode â€¢ c âˆˆ a.children âŸ¹ c âˆˆ atoms
  
  no_cyclic_references: 
    âˆ€ a: AtomNode â€¢ a âˆˆ atoms âŸ¹ 
      a âˆ‰ transitive_children(a)
  
  index_consistency: 
    âˆ€ name: seq char â€¢ name âˆˆ dom atomIndex âŸ¹ 
      âˆƒ a: AtomNode â€¢ a = atoms[atomIndex(name)] âˆ§ a.name = name
  
  truth_values_bounded: 
    âˆ€ a: AtomNode â€¢ a âˆˆ atoms âŸ¹ 
      0.0 â‰¤ a.truthValue.strength â‰¤ 1.0 âˆ§ 
      0.0 â‰¤ a.truthValue.confidence â‰¤ 1.0

â”Œâ”€ ÎAtomSpace â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Read-only AtomSpace (state unchanged)                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ÎAtomSpace]
  AtomSpace
  AtomSpace'
  
  atoms' = atoms
  atomIndex' = atomIndex

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SECTION 5: REASONING ENGINE STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ PLNState â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Probabilistic Logic Networks reasoning state                                â”‚
â”‚ Maintains inference history and confidence calculations                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[PLNState]
  inferenceHistory: seq (AtomNode Ã— AtomNode Ã— AtomNode)  -- Premise1, Premise2, Conclusion
  ruleApplications: â„•
  averageConfidence: â„
  
  -- State Invariants
  inference_atoms_exist: 
    âˆ€ (p1, p2, c): (AtomNode Ã— AtomNode Ã— AtomNode) â€¢ 
      (p1, p2, c) âˆˆ inferenceHistory âŸ¹ 
        âˆƒ as: AtomSpace â€¢ p1 âˆˆ as.atoms âˆ§ p2 âˆˆ as.atoms âˆ§ c âˆˆ as.atoms
  
  confidence_range: 
    0.0 â‰¤ averageConfidence â‰¤ 1.0
  
  applications_history_consistency: 
    ruleApplications = length(inferenceHistory)

â”Œâ”€ ECANState â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Economic Attention Network state                                            â”‚
â”‚ Manages short-term importance (STI) and long-term importance (LTI)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ECANState]
  atomSTI: seq char â†’ â„¤  -- Atom name to short-term importance
  atomLTI: seq char â†’ â„¤  -- Atom name to long-term importance
  attentionalFocus: â„™(seq char)  -- Set of atom names in focus
  totalSTI: â„¤
  totalLTI: â„¤
  
  -- State Invariants
  sti_conservation: 
    totalSTI = Î£{v | v âˆˆ ran atomSTI}
  
  lti_conservation: 
    totalLTI = Î£{v | v âˆˆ ran atomLTI}
  
  focus_high_sti: 
    âˆ€ name: seq char â€¢ name âˆˆ attentionalFocus âŸ¹ 
      atomSTI(name) > ATTENTION_THRESHOLD
  
  sti_lti_domains_match: 
    dom atomSTI = dom atomLTI
  
  sti_range: 
    âˆ€ v: â„¤ â€¢ v âˆˆ ran atomSTI âŸ¹ MIN_STI â‰¤ v â‰¤ MAX_STI
  
  lti_range: 
    âˆ€ v: â„¤ â€¢ v âˆˆ ran atomLTI âŸ¹ MIN_LTI â‰¤ v â‰¤ MAX_LTI

â”Œâ”€ MOSESState â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Meta-Optimizing Semantic Evolutionary Search state                          â”‚
â”‚ Maintains population of candidate programs                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[MOSESState]
  population: seq (seq char Ã— â„)  -- Program representation and fitness
  generation: â„•
  bestFitness: â„
  averageFitness: â„
  
  -- State Invariants
  population_nonempty: 
    length(population) > 0
  
  fitness_consistency: 
    bestFitness = max{f | (_, f) âˆˆ population}
  
  average_consistency: 
    averageFitness = (Î£{f | (_, f) âˆˆ population}) / length(population)
  
  best_in_population: 
    âˆƒ (prog, fit): (seq char Ã— â„) â€¢ 
      (prog, fit) âˆˆ population âˆ§ fit = bestFitness
  
  fitness_bounded: 
    âˆ€ (_, f): (seq char Ã— â„) â€¢ (_, f) âˆˆ population âŸ¹ 
      0.0 â‰¤ f â‰¤ 1.0

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SECTION 6: MEMORY SYSTEM STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ MemoryEntry â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Individual memory entry in the memory system                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[MemoryEntry]
  id: seq char
  content: seq char
  importance: â„
  timestamp: â„•
  accessCount: â„•
  lastAccessed: â„•
  
  -- Invariants
  id_unique: length(id) > 0
  importance_range: 0.0 â‰¤ importance â‰¤ 1.0
  timestamp_valid: timestamp > 0
  access_timestamp_ordering: lastAccessed â‰¥ timestamp
  access_count_positive: accessCount â‰¥ 0

â”Œâ”€ PersistentMemoryState â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Long-term memory storage state                                              â”‚
â”‚ Stores episodic and procedural memories                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[PersistentMemoryState]
  shortTermMemory: seq MemoryEntry
  longTermMemory: seq MemoryEntry
  memoryIndex: seq char â†’ â„•
  
  -- State Invariants
  stm_capacity_bound: 
    length(shortTermMemory) â‰¤ STM_CAPACITY
  
  memory_ids_unique: 
    âˆ€ i, j: â„• â€¢ i â‰  j âˆ§ i < length(shortTermMemory) âˆ§ j < length(shortTermMemory) âŸ¹ 
      shortTermMemory[i].id â‰  shortTermMemory[j].id âˆ§
    âˆ€ i, j: â„• â€¢ i â‰  j âˆ§ i < length(longTermMemory) âˆ§ j < length(longTermMemory) âŸ¹ 
      longTermMemory[i].id â‰  longTermMemory[j].id
  
  stm_ltm_disjoint: 
    âˆ€ s: MemoryEntry â€¢ s âˆˆ shortTermMemory âŸ¹ 
      âˆ€ l: MemoryEntry â€¢ l âˆˆ longTermMemory âŸ¹ s.id â‰  l.id
  
  recent_in_stm: 
    âˆ€ m: MemoryEntry â€¢ m âˆˆ shortTermMemory âŸ¹ 
      m.timestamp > (current_time() - STM_TIME_WINDOW)
  
  important_in_ltm: 
    âˆ€ m: MemoryEntry â€¢ m âˆˆ longTermMemory âŸ¹ 
      m.importance â‰¥ LTM_IMPORTANCE_THRESHOLD âˆ¨ 
      m.accessCount â‰¥ LTM_ACCESS_THRESHOLD
  
  index_consistency: 
    âˆ€ id: seq char â€¢ id âˆˆ dom memoryIndex âŸ¹ 
      (âˆƒ m: MemoryEntry â€¢ m âˆˆ shortTermMemory âˆª longTermMemory âˆ§ m.id = id)

â”Œâ”€ AgentLearningState â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Learning state for individual agents                                        â”‚
â”‚ Tracks experiences, patterns, and acquired skills                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[AgentLearningState]
  agentId: seq char
  experiences: seq (seq char Ã— â„)  -- Experience description and reward
  learnedPatterns: seq (seq char)
  skills: seq char â†’ â„  -- Skill name to proficiency
  
  -- State Invariants
  agent_exists: 
    âˆƒ os: OrchestrationState â€¢ agentId âˆˆ dom os.agents
  
  experiences_ordered: 
    âˆ€ i, j: â„• â€¢ i < j < length(experiences) âŸ¹ 
      timestamp(experiences[i]) â‰¤ timestamp(experiences[j])
  
  reward_range: 
    âˆ€ (_, r): (seq char Ã— â„) â€¢ (_, r) âˆˆ experiences âŸ¹ 
      -1.0 â‰¤ r â‰¤ 1.0
  
  proficiency_range: 
    âˆ€ p: â„ â€¢ p âˆˆ ran skills âŸ¹ 
      0.0 â‰¤ p â‰¤ 1.0
  
  skill_improvement_monotonic: 
    âˆ€ s: seq char â€¢ s âˆˆ dom skills âŸ¹ 
      skills'(s) â‰¥ skills(s)  -- Skills don't decrease

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SECTION 7: LLM CLIENT STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ WebLLMState â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ State of the WebLLM client                                                  â”‚
â”‚ Manages model initialization and execution state                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[WebLLMState]
  initialized: ğ”¹
  currentModel: Model
  engineType: {serviceWorker, webWorker}
  modelCache: â„™ Model  -- Set of cached models
  isGenerating: ğ”¹
  
  -- State Invariants
  model_cached_if_initialized: 
    initialized = true âŸ¹ currentModel âˆˆ modelCache
  
  generating_requires_initialized: 
    isGenerating = true âŸ¹ initialized = true
  
  engine_type_valid: 
    engineType âˆˆ {serviceWorker, webWorker}

â”Œâ”€ MLCLLMState â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ State of the MLC-LLM API client                                             â”‚
â”‚ Manages connection to external MLC-LLM server                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[MLCLLMState]
  endpoint: seq char
  connected: ğ”¹
  availableModels: seq Model
  isGenerating: ğ”¹
  
  -- State Invariants
  endpoint_valid: 
    connected = true âŸ¹ 
      length(endpoint) > 0 âˆ§ is_valid_url(endpoint)
  
  generating_requires_connection: 
    isGenerating = true âŸ¹ connected = true
  
  models_available_when_connected: 
    connected = true âŸ¹ length(availableModels) > 0

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SECTION 8: GLOBAL SYSTEM STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ SystemState â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Complete system state combining all subsystems                              â”‚
â”‚ Top-level state schema with cross-cutting invariants                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[SystemState]
  chatStore: ChatStore
  configStore: ConfigStore
  orchestrationState: OrchestrationState
  atomSpace: AtomSpace
  plnState: PLNState
  ecanState: ECANState
  mosesState: MOSESState
  memoryState: PersistentMemoryState
  agentLearning: seq char â†’ AgentLearningState
  webllmState: WebLLMState
  mlcllmState: MLCLLMState
  
  -- Global Cross-Cutting Invariants
  
  client_model_consistency: 
    configStore.config.modelClientType = WEBLLM âŸ¹ 
      webllmState.currentModel = configStore.config.modelConfig.model âˆ§
    configStore.config.modelClientType = MLCLLM_API âŸ¹ 
      mlcllmState.endpoint = configStore.config.modelConfig.mlc_endpoint
  
  single_generation_source: 
    Â¬(webllmState.isGenerating âˆ§ mlcllmState.isGenerating)
  
  generation_state_consistency: 
    chatStore.sessions[chatStore.currentSessionIndex].isGenerating âŸº 
      (webllmState.isGenerating âˆ¨ mlcllmState.isGenerating)
  
  agent_learning_registered: 
    âˆ€ id: seq char â€¢ id âˆˆ dom agentLearning âŸ¹ 
      id âˆˆ dom orchestrationState.agents
  
  atomspace_ecan_consistency: 
    dom ecanState.atomSTI = {a.name | a âˆˆ atomSpace.atoms âˆ§ a.name â‰  ""}
  
  memory_agent_correlation: 
    length(memoryState.longTermMemory) > 0 âŸ¹ 
      âˆƒ a: Agent â€¢ a âˆˆ ran orchestrationState.agents âˆ§ 
        a.role = "KnowledgeAgent"
  
  reasoning_requires_atomspace: 
    plnState.ruleApplications > 0 âŸ¹ 
      length(atomSpace.atoms) > 0
  
  active_task_session_sync: 
    orchestrationState.activeSession â‰  "" âŸ¹ 
      chatStore.sessions[chatStore.currentSessionIndex].isGenerating = true

â”Œâ”€ Î”SystemState â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ System state change (before and after states)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Î”SystemState]
  SystemState
  SystemState'

â”Œâ”€ ÎSystemState â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Read-only system state (no state change)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ÎSystemState]
  SystemState
  SystemState'
  
  chatStore' = chatStore
  configStore' = configStore
  orchestrationState' = orchestrationState
  atomSpace' = atomSpace
  plnState' = plnState
  ecanState' = ecanState
  mosesState' = mosesState
  memoryState' = memoryState
  agentLearning' = agentLearning
  webllmState' = webllmState
  mlcllmState' = mlcllmState

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SECTION 9: HELPER FUNCTIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[Helper Functions]
  transitive_task_dependencies: seq char â†’ â„™(seq char)
  is_well_formed_atom: AtomNode â†’ ğ”¹
  requires_capability: seq char Ã— seq char â†’ ğ”¹
  current_time: â†’ â„•
  timestamp: (seq char Ã— â„) â†’ â„•

[Constants]
  ATTENTION_THRESHOLD: â„¤
  MIN_STI, MAX_STI: â„¤
  MIN_LTI, MAX_LTI: â„¤
  STM_CAPACITY: â„•
  STM_TIME_WINDOW: â„•
  LTM_IMPORTANCE_THRESHOLD: â„
  LTM_ACCESS_THRESHOLD: â„•

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
END OF SYSTEM STATE SPECIFICATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
